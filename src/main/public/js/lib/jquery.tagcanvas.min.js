/**
 * Copyright (C) 2010-2013 Graham Breach
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
/**
 * jQuery.tagcanvas 2.1.2
 * For more information, please contact <graham@goat1000.com>
 */
(function(W){var ag,af,T=Math.abs,u=Math.sin,k=Math.cos,F=Math.max,ak=Math.min,P=Math.ceil,H={},J={},N={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},d,X,c,n=document,E,b={};for(ag=0;ag<256;++ag){af=ag.toString(16);if(ag<16){af="0"+af}J[af]=J[af.toUpperCase()]=ag.toString()+","}function ab(i){return typeof(i)!="undefined"}function a(i,j,am){return isNaN(i)?am:ak(am,F(j,i))}function R(){return false}function m(am,ap){var j=[],an=am.length,ao;for(ao=0;ao<an;++ao){j.push(am[ao])}j.sort(ap);return j}function V(j){var an=j.length-1,am,ao;while(an){ao=~~(Math.random()*an);am=j[an];j[an]=j[ao];j[ao]=am;--an}}function g(i){this[1]={1:i[0],2:i[1],3:i[2],4:i[3]};this[2]={1:i[4],2:i[5],3:i[6],4:i[7]};this[3]={1:i[8],2:i[9],3:i[10],4:i[11]};this[4]={1:i[12],2:i[13],3:i[14],4:i[15]}}g.Identity=function(){return new g([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};g.prototype.mul=function(am){var an=[],ap,ao;for(ap=1;ap<=4;++ap){for(ao=1;ao<=4;++ao){an.push(this[ap][1]*am[1][ao]+this[ap][2]*am[2][ao]+this[ap][3]*am[3][ao]+this[ap][4]*am[4][ao])}}return new g(an)};g.prototype.xform=function(an){var am={},i=an.x,ap=an.y,ao=an.z,j=ab(an.w)?an.w:1;am.x=i*this[1][1]+ap*this[2][1]+ao*this[3][1]+j*this[4][1];am.y=i*this[1][2]+ap*this[2][2]+ao*this[3][2]+j*this[4][2];am.z=i*this[1][3]+ap*this[2][3]+ao*this[3][3]+j*this[4][3];am.w=i*this[1][4]+ap*this[2][4]+ao*this[3][4]+j*this[4][4];return am};function r(an,ap,av,ar){var aq,au,j,at,aw=[],ao=Math.PI*(3-Math.sqrt(5)),am=2/an;for(aq=0;aq<an;++aq){au=aq*am-1+(am/2);j=Math.sqrt(1-au*au);at=aq*ao;aw.push([k(at)*j*ap,au*av,u(at)*j*ar])}return aw}function aj(ao,am,ar,ay,aw){var ax,az=[],ap=Math.PI*(3-Math.sqrt(5)),an=2/ao,av,au,at,aq;for(av=0;av<ao;++av){au=av*an-1+(an/2);ax=av*ap;at=k(ax);aq=u(ax);az.push(am?[au*ar,at*ay,aq*aw]:[at*ar,au*ay,aq*aw])}return az}function M(am,an,aq,ax,av,at){var aw,ay=[],ao=Math.PI*2/an,au,ar,ap;for(au=0;au<an;++au){aw=au*ao;ar=k(aw);ap=u(aw);ay.push(am?[at*aq,ar*ax,ap*av]:[ar*aq,at*ax,ap*av])}return ay}function B(an,i,j,am){return aj(an,0,i,j,am)}function Q(an,i,j,am){return aj(an,1,i,j,am)}function z(ao,i,j,am,an){an=isNaN(an)?0:an*1;return M(0,ao,i,j,am,an)}function K(ao,i,j,am,an){an=isNaN(an)?0:an*1;return M(1,ao,i,j,am,an)}function t(ap,i){var ao=ap,an,am,j=(i*1).toPrecision(3)+")";if(ap[0]==="#"){if(!H[ap]){if(ap.length===4){H[ap]="rgba("+N[ap[1]]+N[ap[2]]+N[ap[3]]}else{H[ap]="rgba("+J[ap.substr(1,2)]+J[ap.substr(3,2)]+J[ap.substr(5,2)]}}ao=H[ap]+j}else{if(ap.substr(0,4)==="rgb("||ap.substr(0,4)==="hsl("){ao=(ap.replace("(","a(").replace(")",","+j))}else{if(ap.substr(0,5)==="rgba("||ap.substr(0,5)==="hsla("){an=ap.lastIndexOf(",")+1,am=ap.indexOf(")");i*=parseFloat(ap.substring(an,am));ao=ap.substr(0,an)+i.toPrecision(3)+")"}}}return ao}function h(i,j){if(window.G_vmlCanvasManager){return null}var am=n.createElement("canvas");am.width=i;am.height=j;return am}function A(){var j=h(3,3),an,am;if(!j){return false}an=j.getContext("2d");an.strokeStyle="#000";an.shadowColor="#fff";an.shadowBlur=3;an.globalAlpha=0;an.strokeRect(2,2,2,2);an.globalAlpha=1;am=an.getImageData(2,2,1,1);j=null;return(am.data[0]>0)}function al(au,j){var am=1024,ap=au.weightGradient,ao,ar,an,at,aq;if(au.gCanvas){ar=au.gCanvas.getContext("2d")}else{au.gCanvas=ao=h(am,1);if(!ao){return null}ar=ao.getContext("2d");at=ar.createLinearGradient(0,0,am,0);for(an in ap){at.addColorStop(1-an,ap[an])}ar.fillStyle=at;ar.fillRect(0,0,am,1)}aq=ar.getImageData(~~((am-1)*j),0,1,1).data;return"rgba("+aq[0]+","+aq[1]+","+aq[2]+","+(aq[3]/255)+")"}function y(ar,aq,an,ay,at,au,am,av,aw){var ap=(au||0)+(am&&am[0]<0?T(am[0]):0),j=(au||0)+(am&&am[1]<0?T(am[1]):0),ao,ax;ar.font=aq;ar.textBaseline="top";ar.fillStyle=an;at&&(ar.shadowColor=at);au&&(ar.shadowBlur=au);am&&(ar.shadowOffsetX=am[0],ar.shadowOffsetY=am[1]);for(ao=0;ao<ay.length;++ao){ax=aw?(av-aw[ao])/2:0;ar.fillText(ay[ao],ap+ax,j);j+=parseInt(aq)}}function p(aB,ar,ax,az,aq,an,av,aw,j,aA,ay,au,am){var ao=az+T(j[0])+aw+aw,i=aq+T(j[1])+aw+aw,ap,at;ap=h(ao+aA,i+ay);if(!ap){return null}at=ap.getContext("2d");y(at,ar,an,aB,av,aw,j,au,am);return ap}function ae(ar,av,aw,an){var ax=T(an[0]),at=T(an[1]),ao=ar.width+(ax>aw?ax+aw:aw*2),j=ar.height+(at>aw?at+aw:aw*2),aq=(aw||0)+(an[0]<0?ax:0),am=(aw||0)+(an[1]<0?at:0),ap,au;ap=h(ao,j);if(!ap){return null}au=ap.getContext("2d");av&&(au.shadowColor=av);aw&&(au.shadowBlur=aw);an&&(au.shadowOffsetX=an[0],au.shadowOffsetY=an[1]);au.drawImage(ar,aq,am,ar.width,ar.height);return ap}function Y(az,aq,ax){var ay=parseInt(az.toString().length*ax),ap=parseInt(ax*2*az.length),an=h(ay,ap),au,j,ao,at,aw,av,am,ar;if(!an){return null}au=an.getContext("2d");au.fillStyle="#000";au.fillRect(0,0,ay,ap);y(au,ax+"px "+aq,"#fff",az,0,0,[]);j=au.getImageData(0,0,ay,ap);ao=j.width;at=j.height;ar={min:{x:ao,y:at},max:{x:-1,y:-1}};for(av=0;av<at;++av){for(aw=0;aw<ao;++aw){am=(av*ao+aw)*4;if(j.data[am+1]>0){if(aw<ar.min.x){ar.min.x=aw}if(aw>ar.max.x){ar.max.x=aw}if(av<ar.min.y){ar.min.y=av}if(av>ar.max.y){ar.max.y=av}}}}if(ao!=ay){ar.min.x*=(ay/ao);ar.max.x*=(ay/ao)}if(at!=ap){ar.min.y*=(ay/at);ar.max.y*=(ay/at)}an=null;return ar}function w(i){return"'"+i.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function D(i,j,am){am=am||n;if(am.addEventListener){am.addEventListener(i,j,false)}else{am.attachEvent("on"+i,j)}}function ad(ao,aq,an,am){var ap=am.imageScale,j;if(!aq.complete){return D("load",function(){ad(ao,aq,an,am)},aq)}if(!ao.complete){return D("load",function(){ad(ao,aq,an,am)},ao)}aq.width=aq.width;aq.height=aq.height;if(ap){ao.width=aq.width*ap;ao.height=aq.height*ap}an.w=ao.width;an.h=ao.height;if(am.txtOpt&&am.shadow){j=ae(ao,am.shadow,am.shadowBlur,am.shadowOffset);if(j){an.image=j;an.w=j.width;an.h=j.height}}}function aa(an,am){var j=n.defaultView,i=am.replace(/\-([a-z])/g,function(ao){return ao.charAt(1).toUpperCase()});return(j&&j.getComputedStyle&&j.getComputedStyle(an,null).getPropertyValue(am))||(an.currentStyle&&an.currentStyle[i])}function C(am,j){var i=1,an;if(am.weightFrom){i=1*(j.getAttribute(am.weightFrom)||am.textHeight)}else{if(an=aa(j,"font-size")){i=(an.indexOf("px")>-1&&an.replace("px","")*1)||(an.indexOf("pt")>-1&&an.replace("pt","")*1.25)||an*3.3}else{am.weight=false}}return i}function x(i){return i.target&&ab(i.target.id)?i.target.id:i.srcElement.parentNode.id}function I(ao,ap){var an,am,i=parseInt(aa(ap,"width"))/ap.width,j=parseInt(aa(ap,"height"))/ap.height;if(ab(ao.offsetX)){an={x:ao.offsetX,y:ao.offsetY}}else{am=q(ap.id);if(ab(ao.changedTouches)){ao=ao.changedTouches[0]}if(ao.pageX){an={x:ao.pageX-am.x,y:ao.pageY-am.y}}}if(an&&i&&j){an.x/=i;an.y/=j}return an}function l(am){var j=am.target||am.fromElement.parentNode,i=v.tc[j.id];if(i){i.mx=i.my=-1;i.UnFreeze();i.EndDrag()}}function Z(aq){var an,am=v,j,ap,ao=x(aq);for(an in am.tc){j=am.tc[an];if(j.tttimer){clearTimeout(j.tttimer);j.tttimer=null}}if(ao&&am.tc[ao]){j=am.tc[ao];if(ap=I(aq,j.canvas)){j.mx=ap.x;j.my=ap.y;j.Drag(aq,ap)}j.drawn=0}}function S(an){var j=v,i=n.addEventListener?0:1,am=x(an);if(am&&an.button==i&&j.tc[am]){j.tc[am].BeginDrag(an)}}function f(ao){var am=v,j=n.addEventListener?0:1,an=x(ao),i;if(an&&ao.button==j&&am.tc[an]){i=am.tc[an];Z(ao);if(!i.EndDrag()&&!i.touched){i.Clicked(ao)}}}function G(am){var i=v,j=x(am);if(j&&am.changedTouches&&i.tc[j]){i.tc[j].touched=1;i.tc[j].BeginDrag(am)}}function o(am){var i=v,j=x(am);if(j&&am.changedTouches&&i.tc[j]){U(am);if(!i.tc[j].EndDrag()){i.tc[j].Draw();i.tc[j].Clicked(am)}}}function U(aq){var an,am=v,j,ap,ao=x(aq);for(an in am.tc){j=am.tc[an];if(j.tttimer){clearTimeout(j.tttimer);j.tttimer=null}}if(ao&&am.tc[ao]&&aq.changedTouches){j=am.tc[ao];if(ap=I(aq,j.canvas)){j.mx=ap.x;j.my=ap.y;j.Drag(aq,ap)}j.drawn=0}}function ai(am){var i=v,j=x(am);if(j&&i.tc[j]){am.cancelBubble=true;am.returnValue=false;am.preventDefault&&am.preventDefault();i.tc[j].Wheel((am.wheelDelta||am.detail)>0)}}function s(ao){var j=v.tc,an,am;ao=ao||new Date().valueOf();for(an in j){am=j[an].interval;j[an].Draw(ao)}v.NextFrame(am)}function q(am){var ap=n.getElementById(am),i=ap.getBoundingClientRect(),at=n.documentElement,aq=n.body,ar=window,an=ar.pageXOffset||at.scrollLeft,au=ar.pageYOffset||at.scrollTop,ao=at.clientLeft||aq.clientLeft,j=at.clientTop||aq.clientTop;return{x:i.left+an-ao,y:i.top+au-j}}function ah(j,an,ao,am){var i=j.radius*j.z1/(j.z1+j.z2+an.z);return{x:an.x*i*ao,y:an.y*i*am,z:an.z,w:(j.z1-an.z)/j.z2}}function L(i){this.e=i;this.br=0;this.line=[];this.text=[];this.original=i.innerText||i.textContent}L.prototype.Lines=function(ao){var an=ao?1:0,ap,j,am;ao=ao||this.e;ap=ao.childNodes;j=ap.length;for(am=0;am<j;++am){if(ap[am].nodeName=="BR"){this.text.push(this.line.join(" "));this.br=1}else{if(ap[am].nodeType==3){if(this.br){this.line=[ap[am].nodeValue];this.br=0}else{this.line.push(ap[am].nodeValue)}}else{this.Lines(ap[am])}}}an||this.br||this.text.push(this.line.join(" "));return this.text};L.prototype.SplitWidth=function(am,au,aq,ap){var ao,an,at,ar=[];au.font=ap+"px "+aq;for(ao=0;ao<this.text.length;++ao){at=this.text[ao].split(/\s+/);this.line=[at[0]];for(an=1;an<at.length;++an){if(au.measureText(this.line.join(" ")+" "+at[an]).width>am){ar.push(this.line.join(" "));this.line=[at[an]]}else{this.line.push(at[an])}}ar.push(this.line.join(" "))}return this.text=ar};function e(i){this.ts=new Date().valueOf();this.tc=i;this.x=this.y=this.w=this.h=this.sc=1;this.z=0;this.Draw=i.pulsateTo<1&&i.outlineMethod!="colour"?this.DrawPulsate:this.DrawSimple;this.SetMethod(i.outlineMethod)}d=e.prototype;d.SetMethod=function(am){var j={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],none:["LastDraw"]},i=j[am]||j.outline;if(am=="none"){this.Draw=function(){return 1}}else{this.drawFunc=this[i[1]]}this[i[0]]=this.Draw};d.Update=function(at,ar,au,ao,ap,aq,an,i){var j=this.tc.outlineOffset,am=2*j;this.x=ap*at+an-j;this.y=ap*ar+i-j;this.w=ap*au+am;this.h=ap*ao+am;this.sc=ap;this.z=aq};d.DrawOutline=function(ap,i,ao,j,am,an){ap.strokeStyle=an;ap.strokeRect(i,ao,j,am)};d.DrawColour=function(an,aq,ao,ar,am,i,at,j,ap){return this[at.image?"DrawColourImage":"DrawColourText"](an,aq,ao,ar,am,i,at,j,ap)};d.DrawColourText=function(ao,ar,ap,at,am,i,au,j,aq){var an=au.colour;au.colour=i;au.alpha=1;au.Draw(ao,j,aq);au.colour=an;return 1};d.DrawColourImage=function(ar,av,at,aw,aq,i,az,j,au){var ax=ar.canvas,ao=~~F(av,0),an=~~F(at,0),ap=ak(ax.width-ao,aw)+0.5|0,ay=ak(ax.height-an,aq)+0.5|0,am;if(E){E.width=ap,E.height=ay}else{E=h(ap,ay)}if(!E){return this.SetMethod("outline")}am=E.getContext("2d");am.drawImage(ax,ao,an,ap,ay,0,0,ap,ay);ar.clearRect(ao,an,ap,ay);az.alpha=1;az.Draw(ar,j,au);ar.setTransform(1,0,0,1,0,0);ar.save();ar.beginPath();ar.rect(ao,an,ap,ay);ar.clip();ar.globalCompositeOperation="source-in";ar.fillStyle=i;ar.fillRect(ao,an,ap,ay);ar.restore();ar.globalCompositeOperation="destination-over";ar.drawImage(E,0,0,ap,ay,ao,an,ap,ay);ar.globalCompositeOperation="source-over";return 1};d.DrawBlock=function(ap,i,ao,j,am,an){ap.fillStyle=an;ap.fillRect(i,ao,j,am)};d.DrawSimple=function(ao,i,j,an){var am=this.tc;ao.setTransform(1,0,0,1,0,0);ao.strokeStyle=am.outlineColour;ao.lineWidth=am.outlineThickness;ao.shadowBlur=ao.shadowOffsetX=ao.shadowOffsetY=0;ao.globalAlpha=1;return this.drawFunc(ao,this.x,this.y,this.w,this.h,am.outlineColour,i,j,an)};d.DrawPulsate=function(ap,i,j,an){var ao=new Date().valueOf()-this.ts,am=this.tc;ap.setTransform(1,0,0,1,0,0);ap.strokeStyle=am.outlineColour;ap.lineWidth=am.outlineThickness;ap.shadowBlur=ap.shadowOffsetX=ap.shadowOffsetY=0;ap.globalAlpha=am.pulsateTo+((1-am.pulsateTo)*(0.5+(k(2*Math.PI*ao/(1000*am.pulsateTime))/2)));return this.drawFunc(ap,this.x,this.y,this.w,this.h,am.outlineColour,i,j,an)};d.Active=function(am,i,j){return(i>=this.x&&j>=this.y&&i<=this.x+this.w&&j<=this.y+this.h)};d.PreDraw=d.PostDraw=d.LastDraw=R;function O(an,au,aq,at,ar,ao,j,am,i){var ap=an.ctxt;this.tc=an;this.image=au.src?au:null;this.text=au.src?[]:au;this.text_original=i;this.line_widths=[];this.title=aq.title||null;this.a=aq;this.position={x:at[0],y:at[1],z:at[2]};this.x=this.y=this.z=0;this.w=ar;this.h=ao;this.colour=j||an.textColour;this.textFont=am||an.textFont;this.weight=this.sc=this.alpha=1;this.weighted=!an.weight;this.outline=new e(an);if(!this.image){this.textHeight=an.textHeight;this.extents=Y(this.text,this.textFont,this.textHeight);this.Measure(ap,an)}this.SetShadowColour=an.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed;this.SetDraw(an)}X=O.prototype;X.EqualTo=function(am){var j=am.getElementsByTagName("img");if(this.a.href!=am.href){return 0}if(j.length){return this.image.src==j[0].src}return(am.innerText||am.textContent)==this.text_original};X.SetDraw=function(i){this.Draw=this.image?(i.ie>7?this.DrawImageIE:this.DrawImage):this.DrawText;i.noSelect&&(this.CheckActive=R)};X.MeasureText=function(ap){var an,am=this.text.length,j=0,ao;for(an=0;an<am;++an){this.line_widths[an]=ao=ap.measureText(this.text[an]).width;j=F(j,ao)}return j};X.Measure=function(aq,j){this.h=this.extents?this.extents.max.y+this.extents.min.y:this.textHeight;aq.font=this.font=this.textHeight+"px "+this.textFont;this.w=this.MeasureText(aq);if(j.txtOpt){var an=j.txtScale,ao=an*this.textHeight,ap=ao+"px "+this.textFont,am=[an*j.shadowOffset[0],an*j.shadowOffset[1]],i;aq.font=ap;i=this.MeasureText(aq);this.image=p(this.text,ap,ao,i,an*this.h,this.colour,j.shadow,an*j.shadowBlur,am,an,an,i,this.line_widths);if(this.image){this.w=this.image.width/an;this.h=this.image.height/an}this.SetDraw(j);j.txtOpt=!!this.image}};X.SetFont=function(i,j){this.textFont=i;this.colour=j;this.extents=Y(this.text,this.textFont,this.textHeight);this.Measure(this.tc.ctxt,this.tc)};X.SetWeight=function(i){if(!this.text.length){return}this.weight=i;this.Weight(this.tc.ctxt,this.tc);this.Measure(this.tc.ctxt,this.tc)};X.Weight=function(an,am){var j=this.weight,i=am.weightMode;this.weighted=true;if(i=="colour"||i=="both"){this.colour=al(am,(j-am.min_weight)/(am.max_weight-am.min_weight))}if(i=="size"||i=="both"){if(am.weightSizeMin>0&&am.weightSizeMax>am.weightSizeMin){this.textHeight=am.weightSize*(am.weightSizeMin+(am.weightSizeMax-am.weightSizeMin)*(j-am.min_weight)/(am.max_weight-am.min_weight))}else{this.textHeight=j*am.weightSize}}this.extents=Y(this.text,this.textFont,this.textHeight)};X.SetShadowColourFixed=function(am,j,i){am.shadowColor=j};X.SetShadowColourAlpha=function(am,j,i){am.shadowColor=t(j,i)};X.DrawText=function(ao,ar,an){var at=this.tc,aq=this.x,ap=this.y,au=this.sc,j,am;ao.globalAlpha=this.alpha;ao.fillStyle=this.colour;at.shadow&&this.SetShadowColour(ao,at.shadow,this.alpha);ao.font=this.font;aq+=ar/au;ap+=(an/au)-(this.h/2);for(j=0;j<this.text.length;++j){am=aq-(this.line_widths[j]/2);ao.setTransform(au,0,0,au,au*am,au*ap);ao.fillText(this.text[j],0,0);ap+=this.textHeight}};X.DrawImage=function(ao,av,an){var ar=this.x,ap=this.y,aw=this.sc,j=this.image,at=this.w,am=this.h,aq=this.alpha,au=this.shadow;ao.globalAlpha=aq;au&&this.SetShadowColour(ao,au,aq);ar+=(av/aw)-(at/2);ap+=(an/aw)-(am/2);ao.setTransform(aw,0,0,aw,aw*ar,aw*ap);ao.drawImage(j,0,0,at,am)};X.DrawImageIE=function(ao,at,an){var j=this.image,au=this.sc,ar=j.width=this.w*au,am=j.height=this.h*au,aq=(this.x*au)+at-(ar/2),ap=(this.y*au)+an-(am/2);ao.setTransform(1,0,0,1,0,0);ao.globalAlpha=this.alpha;ao.drawImage(j,aq,ap)};X.Calc=function(i){var j,ao=this.tc,an=ao.minBrightness,am=ao.maxBrightness,ap=ao.max_radius;j=i.xform(this.position);j=ah(ao,j,ao.stretchX,ao.stretchY);this.x=j.x;this.y=j.y;this.z=j.z;this.sc=j.w;this.alpha=a(an+(am-an)*(ap-this.z)/(2*ap),0,1)};X.CheckActive=function(an,ar,am){var at=this.tc,i=this.outline,aq=this.w,j=this.h,ap=this.x-aq/2,ao=this.y-j/2;i.Update(ap,ao,aq,j,this.sc,this.z,ar,am);return i.Active(an,at.mx,at.my)?i:null};X.Clicked=function(ap){var j=this.a,am=j.target,an=j.href,i;if(am!=""&&am!="_self"){if(self.frames[am]){self.frames[am].document.location=an}else{try{if(top.frames[am]){top.frames[am].document.location=an;return}}catch(ao){}window.open(an,am)}return}if(n.createEvent){i=n.createEvent("MouseEvents");i.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null);if(!j.dispatchEvent(i)){return}}else{if(j.fireEvent){if(!j.fireEvent("onclick")){return}}}n.location=an};function v(ar,j,an){var am,ap,aq=n.getElementById(ar),ao=["id","class","innerHTML"];if(!aq){throw 0}if(ab(window.G_vmlCanvasManager)){aq=window.G_vmlCanvasManager.initElement(aq);this.ie=parseFloat(navigator.appVersion.split("MSIE")[1])}if(aq&&(!aq.getContext||!aq.getContext("2d").fillText)){ap=n.createElement("DIV");for(am=0;am<ao.length;++am){ap[ao[am]]=aq[ao[am]]}aq.parentNode.insertBefore(ap,aq);aq.parentNode.removeChild(aq);throw 0}for(am in v.options){this[am]=an&&ab(an[am])?an[am]:(ab(v[am])?v[am]:v.options[am])}this.canvas=aq;this.ctxt=aq.getContext("2d");this.z1=250/this.depth;this.z2=this.z1/this.zoom;this.radius=ak(aq.height,aq.width)*0.0075;this.max_weight=0;this.min_weight=200;this.textFont=this.textFont&&w(this.textFont);this.textHeight*=1;this.pulsateTo=a(this.pulsateTo,0,1);this.minBrightness=a(this.minBrightness,0,1);this.maxBrightness=a(this.maxBrightness,this.minBrightness,1);this.ctxt.textBaseline="top";this.lx=(this.lock+"").indexOf("x")+1;this.ly=(this.lock+"").indexOf("y")+1;this.frozen=0;this.dx=this.dy=0;this.touched=0;this.source=j||ar;this.transform=g.Identity();this.time=new Date().valueOf();this.Animate=this.dragControl?this.AnimateDrag:this.AnimatePosition;if(this.shadowBlur||this.shadowOffset[0]||this.shadowOffset[1]){this.ctxt.shadowColor=this.shadow;this.shadow=this.ctxt.shadowColor;this.shadowAlpha=A()}else{delete this.shadow}this.Load();if(j&&this.hideTags){(function(i){if(v.loaded){i.HideTags()}else{D("load",function(){i.HideTags()},window)}})(this)}this.yaw=this.initial?this.initial[0]*this.maxSpeed:0;this.pitch=this.initial?this.initial[1]*this.maxSpeed:0;if(this.tooltip){if(this.tooltip=="native"){this.Tooltip=this.TooltipNative}else{this.Tooltip=this.TooltipDiv;if(!this.ttdiv){this.ttdiv=n.createElement("div");this.ttdiv.className=this.tooltipClass;this.ttdiv.style.position="absolute";this.ttdiv.style.zIndex=aq.style.zIndex+1;D("mouseover",function(i){i.target.style.display="none"},this.ttdiv);n.body.appendChild(this.ttdiv)}}}else{this.Tooltip=this.TooltipNone}if(!this.noMouse&&!b[ar]){D("mousemove",Z,aq);D("mouseout",l,aq);D("mouseup",f,aq);D("touchstart",G,aq);D("touchend",o,aq);D("touchcancel",o,aq);D("touchmove",U,aq);if(this.dragControl){D("mousedown",S,aq);D("selectstart",R,aq)}if(this.wheelZoom){D("mousewheel",ai,aq);D("DOMMouseScroll",ai,aq)}b[ar]=1}v.started||(v.started=setTimeout(s,this.interval))}c=v.prototype;c.SourceElements=function(){if(n.querySelectorAll){return n.querySelectorAll("#"+this.source)}return[n.getElementById(this.source)]};c.HideTags=function(){var am=this.SourceElements(),j;for(j=0;j<am.length;++j){am[j].style.display="none"}};c.GetTags=function(){var aq=this.SourceElements(),ap,am=[],ao,an;for(ao=0;ao<aq.length;++ao){ap=aq[ao].getElementsByTagName("a");for(an=0;an<ap.length;++an){am.push(ap[an])}}return am};c.CreateTag=function(ar,aq){var j=ar.getElementsByTagName("img"),ao,an,ap,am;aq=aq||[0,0,0];if(j.length){ao=new Image;ao.src=j[0].src;an=new O(this,ao,ar,aq,0,0);ad(ao,j[0],an,this);return an}ap=new L(ar);an=ap.Lines();am=this.textFont||w(aa(ar,"font-family"));if(this.splitWidth){an=ap.SplitWidth(this.splitWidth,this.ctxt,am,this.textHeight)}return new O(this,an,ar,aq,2,this.textHeight+2,this.textColour||aa(ar,"color"),am,ap.original)};c.UpdateTag=function(am,i){var an=this.textColour||aa(i,"color"),j=this.textFont||w(aa(i,"font-family"));am.title=i.title;if(am.colour!=an||am.textFont!=j){am.SetFont(j,an)}};c.Weight=function(an){var am=an.length,j,ao,ap=[];for(ao=0;ao<am;++ao){j=C(this,an[ao].a);if(j>this.max_weight){this.max_weight=j}if(j<this.min_weight){this.min_weight=j}ap.push(j)}if(this.max_weight>this.min_weight){for(ao=0;ao<am;++ao){an[ao].SetWeight(ap[ao])}}};c.Load=function(){var aw=this.GetTags(),ar=[],av,aq,an,am,j,ao,au,ap=[],at={sphere:r,vcylinder:B,hcylinder:Q,vring:z,hring:K};if(aw.length){ap.length=aw.length;for(au=0;au<aw.length;++au){ap[au]=au}this.shuffleTags&&V(ap);an=100*this.radiusX;am=100*this.radiusY;j=100*this.radiusZ;this.max_radius=F(an,F(am,j));if(this.shapeArgs){this.shapeArgs[0]=aw.length}else{aq=this.shape.toString().split(/[(),]/);av=aq.shift();this.shape=at[av]||at.sphere;this.shapeArgs=[aw.length,an,am,j].concat(aq)}ao=this.shape.apply(this,this.shapeArgs);this.listLength=aw.length;for(au=0;au<aw.length;++au){ar.push(this.CreateTag(aw[ap[au]],ao[au]))}this.weight&&this.Weight(ar,true)}this.taglist=ar};c.Update=function(){var aw=this.GetTags(),av=[],ap=this.taglist,ax,au=[],ar=[],an,at,am,aq,ao;if(!this.shapeArgs){return this.Load()}if(aw.length){am=this.listLength=aw.length;at=ap.length;for(aq=0;aq<at;++aq){av.push(ap[aq]);ar.push(aq)}for(aq=0;aq<am;++aq){for(ao=0,ax=0;ao<at;++ao){if(ap[ao].EqualTo(aw[aq])){this.UpdateTag(av[ao],aw[aq]);ax=ar[ao]=-1}}if(!ax){au.push(aq)}}for(aq=0,ao=0;aq<at;++aq){if(ar[ao]==-1){ar.splice(ao,1)}else{++ao}}if(ar.length){V(ar);while(ar.length&&au.length){aq=ar.shift();ao=au.shift();av[aq]=this.CreateTag(aw[ao])}ar.sort(function(j,i){return j-i});while(ar.length){av.splice(ar.pop(),1)}}ao=av.length/(au.length+1);aq=0;while(au.length){av.splice(P(++aq*ao),0,this.CreateTag(aw[au.shift()]))}this.shapeArgs[0]=am=av.length;an=this.shape.apply(this,this.shapeArgs);for(aq=0;aq<am;++aq){av[aq].position={x:an[aq][0],y:an[aq][1],z:an[aq][2]}}this.weight&&this.Weight(av)}this.taglist=av};c.SetShadow=function(i){i.shadowBlur=this.shadowBlur;i.shadowOffsetX=this.shadowOffset[0];i.shadowOffsetY=this.shadowOffset[1]};c.Draw=function(aw){if(this.paused){return}var aq=this.canvas,ao=aq.width,av=aq.height,ay=0,an=(aw-this.time)*this.interval/1000,au=ao/2+this.offsetX,at=av/2+this.offsetY,aC=this.ctxt,ar,aD,aA,am=-1,ap=this.taglist,az=ap.length,j=this.frontSelect,ax=(this.centreFunc==R);this.time=aw;if(this.frozen&&this.drawn){return this.Animate(ao,av,an)}aC.setTransform(1,0,0,1,0,0);this.active=null;for(aA=0;aA<az;++aA){ap[aA].Calc(this.transform)}ap=m(ap,function(aE,i){return i.z-aE.z});for(aA=0;aA<az;++aA){aD=this.mx>=0&&this.my>=0&&this.taglist[aA].CheckActive(aC,au,at);if(aD&&aD.sc>ay&&(!j||aD.z<=0)){ar=aD;am=aA;ar.tag=this.taglist[aA];ay=aD.sc}}this.active=ar;this.txtOpt||(this.shadow&&this.SetShadow(aC));aC.clearRect(0,0,ao,av);for(aA=0;aA<az;++aA){if(!ax&&ap[aA].z<=0){try{this.centreFunc(aC,ao,av,au,at)}catch(aB){alert(aB);this.centreFunc=R}ax=true}if(!(ar&&ar.tag==ap[aA]&&ar.PreDraw(aC,ap[aA],au,at))){ap[aA].Draw(aC,au,at)}ar&&ar.tag==ap[aA]&&ar.PostDraw(aC)}if(this.freezeActive&&ar){this.Freeze()}else{this.UnFreeze();this.drawn=(az==this.listLength)}this.Animate(ao,av,an);ar&&ar.LastDraw(aC);aq.style.cursor=ar?this.activeCursor:"";this.Tooltip(ar,this.taglist[am])};c.TooltipNone=function(){};c.TooltipNative=function(j,i){this.canvas.title=j&&i.title?i.title:""};c.TooltipDiv=function(ao,j){var i=this,an=i.ttdiv.style,ap=i.canvas.id,am="none";if(ao&&j.title){if(j.title!=i.ttdiv.innerHTML){an.display=am}i.ttdiv.innerHTML=j.title;j.title=i.ttdiv.innerHTML;if(an.display==am&&!i.tttimer){i.tttimer=setTimeout(function(){var aq=q(ap);an.display="block";an.left=aq.x+i.mx+"px";an.top=aq.y+i.my+24+"px";i.tttimer=null},i.tooltipDelay)}}else{an.display=am}};c.Transform=function(ap,i,ar){if(i||ar){var j=u(i),aq=k(i),at=u(ar),ao=k(ar),am=new g([ao,0,at,0,0,1,0,0,-at,0,ao,0,0,0,0,1]),an=new g([1,0,0,0,0,aq,-j,0,0,j,aq,0,0,0,0,1]);ap.transform=ap.transform.mul(am.mul(an))}};c.AnimatePosition=function(am,ap,an){var j=this,i=j.mx,ar=j.my,ao,aq;if(!j.frozen&&i>=0&&ar>=0&&i<am&&ar<ap){ao=j.maxSpeed,aq=j.reverse?-1:1;j.lx||(j.yaw=aq*an*((ao*2*i/am)-ao));j.ly||(j.pitch=aq*an*-((ao*2*ar/ap)-ao));j.initial=null}else{if(!j.initial){if(j.frozen&&!j.freezeDecel){j.yaw=j.pitch=0}else{j.Decel(j)}}}this.Transform(j,j.pitch,j.yaw)};c.AnimateDrag=function(j,ao,an){var i=this,am=100*an*i.maxSpeed/i.max_radius/i.zoom;if(i.dx||i.dy){i.lx||(i.yaw=i.dx*am/i.stretchX);i.ly||(i.pitch=i.dy*-am/i.stretchY);i.dx=i.dy=0;i.initial=null}else{if(!i.initial){i.Decel(i)}}this.Transform(i,i.pitch,i.yaw)};c.Freeze=function(){if(!this.frozen){this.preFreeze=[this.yaw,this.pitch];this.frozen=1;this.drawn=0}};c.UnFreeze=function(){if(this.frozen){this.yaw=this.preFreeze[0];this.pitch=this.preFreeze[1];this.frozen=0}};c.Decel=function(i){var am=i.minSpeed,an=T(i.yaw),j=T(i.pitch);if(!i.lx&&an>am){i.yaw=an>i.z0?i.yaw*i.decel:0}if(!i.ly&&j>am){i.pitch=j>i.z0?i.pitch*i.decel:0}};c.Zoom=function(i){this.z2=this.z1*(1/i);this.drawn=0};c.Clicked=function(am){var i=this.active;try{i&&i.tag&&i.tag.Clicked(am)}catch(j){}};c.Wheel=function(j){var am=this.zoom+this.zoomStep*(j?1:-1);this.zoom=ak(this.zoomMax,F(this.zoomMin,am));this.Zoom(this.zoom)};c.BeginDrag=function(i){this.down=I(i,this.canvas);i.cancelBubble=true;i.returnValue=false;i.preventDefault&&i.preventDefault()};c.Drag=function(ao,an){if(this.dragControl&&this.down){var am=this.dragThreshold*this.dragThreshold,j=an.x-this.down.x,i=an.y-this.down.y;if(this.dragging||j*j+i*i>am){this.dx=j;this.dy=i;this.dragging=1;this.down=an}}};c.EndDrag=function(){var i=this.dragging;this.dragging=this.down=null;return i};c.Pause=function(){this.paused=true};c.Resume=function(){this.paused=false};v.Start=function(am,i,j){v.tc[am]=new v(am,i,j)};function ac(i,j){v.tc[j]&&v.tc[j][i]()}v.Pause=function(i){ac("Pause",i)};v.Resume=function(i){ac("Resume",i)};v.Reload=function(i){ac("Load",i)};v.Update=function(i){ac("Update",i)};v.NextFrame=function(i){var j=window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;v.NextFrame=j?v.NextFrameRAF:v.NextFrameTimeout;v.NextFrame(i)};v.NextFrameRAF=function(){requestAnimationFrame(s)};v.NextFrameTimeout=function(i){setTimeout(s,i)};v.tc={};v.options={z1:20000,z2:20000,z0:0.0002,freezeActive:false,freezeDecel:false,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:false,depth:0.5,maxSpeed:0.05,minSpeed:0,decel:0.95,interval:20,minBrightness:0.1,maxBrightness:1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],initial:null,hideTags:true,zoom:1,weight:false,weightMode:"size",weightFrom:null,weightSize:1,weightSizeMin:null,weightSizeMax:null,weightGradient:{0:"#f00",0.33:"#ff0",0.66:"#0f0",1:"#00f"},txtOpt:true,txtScale:2,frontSelect:false,wheelZoom:true,zoomMin:0.3,zoomMax:3,zoomStep:0.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,offsetX:0,offsetY:0,shuffleTags:false,noSelect:false,noMouse:false,imageScale:1,paused:false,dragControl:false,dragThreshold:4,centreFunc:R,splitWidth:0};for(ag in v.options){v[ag]=v.options[ag]}window.TagCanvas=v;jQuery.fn.tagcanvas=function(j,i){var am={pause:function(){W(this).each(function(){ac("Pause",W(this)[0].id)})},resume:function(){W(this).each(function(){ac("Resume",W(this)[0].id)})},reload:function(){W(this).each(function(){ac("Reload",W(this)[0].id)})},update:function(){W(this).each(function(){ac("Update",W(this)[0].id)})},};if(typeof(j)=="string"&&am[j]){am[j].apply(this)}else{v.jquery=1;W(this).each(function(){v.Start(W(this)[0].id,i,j)});return v.started}};D("load",function(){v.loaded=1},window)})(jQuery);
